<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>struts2笔记 - Fang's Wiki</title>
    <meta name="keywords" content="Linux, Java, Shell"/>
    <meta name="description" content="Personal Wiki"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/wiki/">Fang's Wiki</a>
    &nbsp;&#187;&nbsp;
    <a href="/wiki/#jsp">jsp</a>
    &nbsp;&#187;&nbsp;struts2笔记
    <span class="updated">Updated&nbsp;
    2016-08-31 12:55
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#struts2">Struts2笔记</a><ul>
<li><a href="#_1">搭建顺序</a><ul>
<li><a href="#0x01-webxml">0x01 配置web.xml</a></li>
<li><a href="#0x02-strutsxml">0x02 新建struts.xml</a></li>
<li><a href="#0x03-action">0x03 创建Action</a></li>
<li><a href="#0x04-strutsxml">0x04 配置struts.xml</a></li>
</ul>
</li>
<li><a href="#_2">原理以及文件结构</a><ul>
<li><a href="#_3">原理</a></li>
<li><a href="#_4">配置文件</a></li>
</ul>
</li>
<li><a href="#_5">深入</a><ul>
<li><a href="#0x00-action">0x00 action搜索顺序</a></li>
<li><a href="#0x01">0x01 动态调用</a><ul>
<li><a href="#_6">方法二：感叹号方式</a></li>
<li><a href="#_7">方法三：通配符方式</a></li>
</ul>
</li>
<li><a href="#0x02">0x02 指定多个配置文件</a></li>
<li><a href="#0x03-action_1">0x03 默认action</a></li>
<li><a href="#0x04-struts">0x04 Struts后缀</a></li>
<li><a href="#0x05">0x05 接受参数</a></li>
<li><a href="#0x06-input">0x06 input返回</a></li>
<li><a href="#0x07-servlet-api">0x07 获得Servlet API</a></li>
<li><a href="#0x08">0x08 注解</a></li>
</ul>
</li>
<li><a href="#_8">拦截器</a><ul>
<li><a href="#_9">使用拦截器方法</a></li>
<li><a href="#_10">默认拦截器</a></li>
<li><a href="#_11">自定义拦截器</a></li>
<li><a href="#_12">堆叠拦截器</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="struts2">Struts2笔记</h1>
<h3 id="_1">搭建顺序</h3>
<h4 id="0x01-webxml">0x01 配置web.xml</h4>
<div class="hlcode"><pre><span class="nt">&lt;filter&gt;</span>
  <span class="nt">&lt;filter-name&gt;</span>struts2<span class="nt">&lt;/filter-name&gt;</span>
  <span class="nt">&lt;filter-class&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>

<span class="nt">&lt;filter-mapping&gt;</span>
  <span class="nt">&lt;filter-name&gt;</span>struts2<span class="nt">&lt;/filter-name&gt;</span>
  <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span>
</pre></div>


<h4 id="0x02-strutsxml">0x02 新建struts.xml</h4>
<blockquote>
<p>在src目录下建立</p>
</blockquote>
<div class="hlcode"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE struts PUBLIC</span>
<span class="cp">        &quot;-//Apache Software Foundation//DTD Struts Configuration 2.3//EN&quot;</span>
<span class="cp">        &quot;http://struts.apache.org/dtds/struts-2.3.dtd&quot;&gt;</span>

<span class="nt">&lt;struts&gt;</span>
<span class="nt">&lt;/struts&gt;</span>
</pre></div>


<h4 id="0x03-action">0x03 创建Action</h4>
<div class="hlcode"><pre><span class="c1">// 让该Action继承ActionSupport</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorldAction</span> <span class="kd">extends</span> <span class="n">ActionSupport</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">execute</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;执行Action&quot;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">SUCCESS</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h4 id="0x04-strutsxml">0x04 配置struts.xml</h4>
<div class="hlcode"><pre><span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&quot;default&quot;</span> <span class="na">extends=</span><span class="s">&quot;struts-default&quot;</span> <span class="na">namespace=</span><span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;action</span> <span class="na">name=</span><span class="s">&quot;helloworld&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.action.HelloWorldAction&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;/action&gt;</span>

<span class="nt">&lt;/package&gt;</span>
</pre></div>


<h3 id="_2">原理以及文件结构</h3>
<h4 id="_3">原理</h4>
<p>主要是基于serlvet来了一层过滤器</p>
<h4 id="_4">配置文件</h4>
<p><strong><em>web.xml</em></strong></p>
<div class="hlcode"><pre><span class="err">用于加载</span><span class="n">struts2</span><span class="err">框架，通过一个过滤器，`</span><span class="n">StrutsPrepareAndExecuteFilter</span><span class="err">`</span>
</pre></div>


<p><strong><em>struts.xml</em></strong></p>
<div class="hlcode"><pre><span class="err">构建</span><span class="n">action</span><span class="err">映射，这个文件是`核心`</span>
</pre></div>


<p><strong><em>struts-config.xml</em></strong></p>
<div class="hlcode"><pre><span class="err">链接</span><span class="n">Web</span><span class="err">客户端和模型组件</span>
</pre></div>


<p><strong><em>struts.properties</em></strong></p>
<div class="hlcode"><pre><span class="err">它是一个全局属性文件，通过</span><span class="nb">key</span><span class="na">-value</span><span class="err">保存</span>

<span class="err">可以把放在这个文件里的配置放在</span><span class="sb">`struts.xml`</span><span class="err">通过</span><span class="sb">`&lt;constant&gt;`</span><span class="err">元素配置</span>
</pre></div>


<h3 id="_5">深入</h3>
<h4 id="0x00-action">0x00 action搜索顺序</h4>
<div class="hlcode"><pre><span class="nl">http:</span><span class="c1">//localhost:8080/path1/path2/path3/hello.action</span>
</pre></div>


<ol>
<li>若package存在：如path1/path2/path3
  判断action是否存在，不存在去默认namespace的package里搜索action</li>
<li>若package不存在：如path1/path2/path3
  则去上一级路径的package</li>
</ol>
<h4 id="0x01">0x01 动态调用</h4>
<div class="hlcode"><pre><span class="err">针对一个</span><span class="n">action</span><span class="err">内有许多方法，但是我们不能因此写很多</span><span class="n">action</span>

<span class="err">方法有三种：`指定</span><span class="n">method</span><span class="err">属性`，`感叹号方式`，`通配符方式`</span>
</pre></div>


<h5 id="_6">方法二：感叹号方式</h5>
<p><strong><em>修改struts.xml，添加属性</em></strong></p>
<div class="hlcode"><pre><span class="nt">&lt;constant</span> <span class="na">name=</span><span class="s">&quot;struts.enable.DynamicMethodInvocation&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;&lt;/constant&gt;</span>
</pre></div>


<p><strong><em>修改struts.xml，修改原action，添加<code>result</code>标签</em></strong></p>
<div class="hlcode"><pre>写在一个action内
<span class="nt">&lt;action</span> <span class="na">name=</span><span class="s">&quot;helloaction&quot;</span> <span class="na">class=</span><span class="s">&quot;&quot;</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;result&gt;</span>/result.jsp<span class="nt">&lt;/result&gt;</span>
  <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">&quot;方法名A&quot;</span><span class="nt">&gt;</span>/methoda.jsp<span class="nt">&lt;/result&gt;</span>
  <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">&quot;方法名B&quot;</span><span class="nt">&gt;</span>/methodb.jsp<span class="nt">&lt;/result&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</pre></div>


<p><strong><em>调用方法</em></strong></p>
<p>如果这个action的name是helloaction，像第二步那样。
helloaction.action 返回result.jsp
helloaction!方法名A.action 返回methoda.jsp
helloaction!方法名B.action 返回methodb.jsp</p>
<h5 id="_7">方法三：通配符方式</h5>
<div class="hlcode"><pre><span class="nt">&lt;action</span> <span class="na">name=</span><span class="s">&quot;helloaction_*&quot;</span> <span class="na">method=</span><span class="s">&quot;{1}&quot;</span> <span class="na">class=</span><span class="s">&quot;&quot;</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;result&gt;</span>/result.jsp<span class="nt">&lt;/result&gt;</span>
  <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">&quot;方法名A&quot;</span><span class="nt">&gt;</span>/{1}.jsp<span class="nt">&lt;/result&gt;</span>
  <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">&quot;方法名B&quot;</span><span class="nt">&gt;</span>/{1}.jsp<span class="nt">&lt;/result&gt;</span>
<span class="nt">&lt;/action&gt;</span>

<span class="c">&lt;!--写在一个action内 --&gt;</span>
<span class="nt">&lt;action</span> <span class="na">name=</span><span class="s">&quot;helloaction_*_*&quot;</span> <span class="na">method=</span><span class="s">&quot;{1}{2}&quot;</span> <span class="na">class=</span><span class="s">&quot;&quot;</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;result&gt;</span>/result.jsp<span class="nt">&lt;/result&gt;</span>
  <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">&quot;方法名A&quot;</span><span class="nt">&gt;</span>/{1}{2}.jsp<span class="nt">&lt;/result&gt;</span>
  <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">&quot;方法名B&quot;</span><span class="nt">&gt;</span>/{1}{2}.jsp<span class="nt">&lt;/result&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</pre></div>


<div class="hlcode"><pre><span class="err">以此类推，下面有一个小技巧</span>
</pre></div>


<div class="hlcode"><pre><span class="nt">&lt;action</span> <span class="na">name=</span><span class="s">&quot;*_*&quot;</span> <span class="na">method=</span><span class="s">&quot;{1}{2}&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.{1}Action&quot;</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;result&gt;</span>/result.jsp<span class="nt">&lt;/result&gt;</span>
  <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">&quot;方法名A&quot;</span><span class="nt">&gt;</span>/{2}.jsp<span class="nt">&lt;/result&gt;</span>
  <span class="nt">&lt;result</span> <span class="na">name=</span><span class="s">&quot;方法名B&quot;</span><span class="nt">&gt;</span>/{2}.jsp<span class="nt">&lt;/result&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</pre></div>


<div class="hlcode"><pre><span class="err">访问方式：</span><span class="n">localhost</span><span class="o">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">HellowAction_add</span><span class="p">.</span><span class="n">action</span>

<span class="err">解释一下：因为本身存在一个</span><span class="n">java</span><span class="err">文件叫</span><span class="n">HelloAction</span><span class="err">，所以可以使用这样的方式</span>
</pre></div>


<h4 id="0x02">0x02 指定多个配置文件</h4>
<div class="hlcode"><pre><span class="err">通过</span><span class="n">include</span><span class="err">标签引入多个配置文件，为不同模块创建模块文件</span>
</pre></div>


<h4 id="0x03-action_1">0x03 默认action</h4>
<div class="hlcode"><pre><span class="err">如果用户不小心输入了错误的地址，则会跳转到指定的一个页面</span>
</pre></div>


<div class="hlcode"><pre><span class="nt">&lt;default-action-ref</span> <span class="na">name=</span><span class="s">&quot;error&quot;</span><span class="nt">&gt;&lt;/default-action-ref&gt;</span>

<span class="nt">&lt;action</span> <span class="na">name=</span><span class="s">&quot;error&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;result&gt;</span>/error.jsp<span class="nt">&lt;/result&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</pre></div>


<h4 id="0x04-struts">0x04 Struts后缀</h4>
<div class="hlcode"><pre><span class="c">&lt;!--name可以改成你想要的，默认是action，多个可以用英文逗号隔开 --&gt;</span> 
<span class="nt">&lt;constant</span> <span class="na">name=</span><span class="s">&quot;struts.action.extension&quot;</span> <span class="na">value=</span><span class="s">&quot;html&quot;</span><span class="nt">&gt;&lt;/constant&gt;</span>
</pre></div>


<h4 id="0x05">0x05 接受参数</h4>
<ul>
<li>
<p>方法一：使用action的属性接受参数</p>
<p>这个方法只要你在指定的action的java文件中将参数作为成员变量声明，然后设置set和get方法就可以了。然后该成员变量就有值了。</p>
</li>
<li>
<p>方法二：使用domain model接受参数</p>
<p>将表单内的字段抽象到一个对象中，放在model包中。并设置set和get方法</p>
<p>在action的java文件中声明这个属性，比如 User user，然后通过get方法取值</p>
<p>修改jsp中的表单中<code>&lt;input name=""&gt;</code>中name的值，比如user.username</p>
<p>这里注意，user是在变量名，是在action的java文件中的名字，然后后面的username这个名字对应着User类中的成员变量username</p>
</li>
<li>
<p>方法三：使用ModelDriven接受参数</p>
<p>action的java类要实现<code>ModelDriven</code>接口，这是个范型，所以可以把User类放进去。</p>
<p>在该action的java文件中实例化User类。然后实现<code>getModel</code>方法，返回已经实例化的User类</p>
<p>然后jsp页面中的input标签内的name属性直接对应model类的成员变量名就可以了</p>
</li>
</ul>
<h4 id="0x06-input">0x06 input返回</h4>
<div class="hlcode"><pre><span class="err">表单提交错误则现实错误信息，要配合使用标签，重写</span><span class="n">valiate</span><span class="p">()</span><span class="err">方法</span>
</pre></div>


<h4 id="0x07-servlet-api">0x07 获得Servlet API</h4>
<ul>
<li>方法一：ActionContext</li>
<li>方法二：实现***Aware接口</li>
<li>方法三：ServletActionContext</li>
</ul>
<h4 id="0x08">0x08 注解</h4>
<div class="hlcode"><pre><span class="err">通过注解可以解放</span><span class="n">struts</span><span class="p">.</span><span class="n">xml</span><span class="err">，直接在</span><span class="n">java</span><span class="err">文件里写注解就可以了。</span>
</pre></div>


<h3 id="_8">拦截器</h3>
<h4 id="_9">使用拦截器方法</h4>
<div class="hlcode"><pre><span class="err">在</span><span class="n">struts</span><span class="p">.</span><span class="n">xml</span><span class="err">中的相应</span><span class="n">action</span><span class="err">内添加标签`</span><span class="o">&lt;</span><span class="n">interceptor</span><span class="o">-</span><span class="n">ref</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">/&gt;</span><span class="err">`</span>
</pre></div>


<h4 id="_10">默认拦截器</h4>
<div class="hlcode"><pre><span class="n">struts2</span><span class="err">自带了一些拦截器。</span>
</pre></div>


<h4 id="_11">自定义拦截器</h4>
<div class="hlcode"><pre><span class="err">第一步、新建类继承`</span><span class="n">AbstractInterceptor</span><span class="err">`即可，然后实现主要方法`</span><span class="n">intercept</span><span class="err">`即可。还有初始化方法或者销毁方法</span>

<span class="err">第二步、在`</span><span class="n">struts</span><span class="p">.</span><span class="n">xml</span><span class="err">`中的</span><span class="n">package</span><span class="err">内，</span><span class="n">action</span><span class="err">外注册自定义拦截器。</span>
</pre></div>


<div class="hlcode"><pre><span class="c">&lt;!-- 先注册这个拦截器 --&gt;</span>
<span class="nt">&lt;interceptors&gt;</span>
  <span class="nt">&lt;interceptor</span> <span class="na">name=</span><span class="s">&quot;&quot;</span> <span class="na">class=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/interceptors&gt;</span>
<span class="c">&lt;!-- 再使用这个拦截器 --&gt;</span>
<span class="nt">&lt;interceptor-ref</span> <span class="na">name=</span><span class="s">&quot;myinterceptor&quot;</span> <span class="nt">/&gt;</span>
<span class="c">&lt;!-- 还需要在自定义拦截器后面添加这个才能让自定义的拦截器成功，因为自定义拦截器会导致默认拦截器失效 --&gt;</span>
<span class="nt">&lt;interceptor-ref</span> <span class="na">name=</span><span class="s">&quot;defaultStack&quot;</span> <span class="nt">/&gt;</span>
</pre></div>


<h4 id="_12">堆叠拦截器</h4>
<blockquote>
<p>第一步 创建堆叠</p>
</blockquote>
<div class="hlcode"><pre><span class="nt">&lt;interceptor-stack</span> <span class="na">name=</span><span class="s">&quot;basicStack&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;interceptor-ref</span> <span class="na">name=</span><span class="s">&quot;exception&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;interceptor-ref</span> <span class="na">name=</span><span class="s">&quot;servlet-config&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;interceptor-ref</span> <span class="na">name=</span><span class="s">&quot;prepare&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;interceptor-ref</span> <span class="na">name=</span><span class="s">&quot;checkbox&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;interceptor-ref</span> <span class="na">name=</span><span class="s">&quot;params&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;interceptor-ref</span> <span class="na">name=</span><span class="s">&quot;conversionError&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/interceptor-stack&gt;</span>
</pre></div>


<blockquote>
<p>第二步 在action内使用这个堆叠拦截器</p>
</blockquote>
<div class="hlcode"><pre><span class="nt">&lt;interceptor-ref</span> <span class="na">name=</span><span class="s">&quot;basicStack&quot;</span><span class="nt">/&gt;</span>
</pre></div>
  
</div>
    </div>
    <div id="footer">
      <div class="footer-left">
        <p>
        Copyright © 2016 Fang.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://git.coding.net/tankywoo/yasimple_x2.git" target="_blank">YASimple_X2</a>.
        </p>
      </div> <!-- end footer-left -->
      <div class="footer-right">
        <p>Site Generated 2016-08-31 13:16:21</p>
      </div> <!-- end footer-right -->
    </div>
  </body>
</html>